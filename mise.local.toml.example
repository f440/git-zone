[env]
PRETTIER_EXPERIMENTAL_CLI = "true"

[settings]
jobs = 8

[tasks."install:bundle"]
description = "bundle install"
run = 'bundle install'

[tasks."install:pnpm"]
description = "pnpm install"
run = 'pnpm install'

[tasks.install]
description = "Install dependencies"
depends = ["install:*"]
alias = "i"

[tasks."zone:setup"]
description = "Setup git-zone"
usage = '''
flag "--worktree-root <worktree_root>" help="Path to the worktree root directory" env="WORKTREE_ROOT"
flag "--zone-dir <zone_dir>" help="Path to the zone directory to set up" env="ZONE_DIR"
'''
run = """
mise install

ln -snf "${usage_worktree_root?}/.env.development.local" "${usage_zone_dir?}/"
ln -snf "${usage_worktree_root?}/lefthook.yml" "${usage_zone_dir?}/"
ln -snf "${usage_worktree_root?}/CLAUDE.md" "${usage_zone_dir?}/"
ln -snf "${usage_worktree_root?}/.claude" "${usage_zone_dir?}/"

ZONE_NAME=$(basename "${usage_zone_dir?}")
SESSION_NAME="${ZONE_NAME//./_}"

tmux new-session -c "${usage_zone_dir?}" -s "$SESSION_NAME" -d
tmux new-window -t "$SESSION_NAME:1" -n install -c "${usage_zone_dir?}" -d "mise install && mise run install"
"""
