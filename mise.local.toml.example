[env]
PRETTIER_EXPERIMENTAL_CLI = "true"

[settings]
jobs = 8

[tasks."install:bundle"]
description = "bundle install"
run = 'bundle install'

[tasks."install:pnpm"]
description = "pnpm install"
run = 'pnpm install'

[tasks.install]
description = "Install dependencies"
depends = ["install:*"]
alias = "i"

[tasks."zone:setup"]
description = "Setup git-zone"
usage = '''
flag "--worktree-root <worktree_root>" help="Path to the worktree root directory" env="WORKTREE_ROOT"
'''
run = """
mise install

ln -snf "${usage_worktree_root?}/.env.development.local" .
ln -snf "${usage_worktree_root?}/lefthook.yml" .
ln -snf "${usage_worktree_root?}/CLAUDE.md" .
ln -snf "${usage_worktree_root?}/.claude" .

ZONE_NAME=$(basename "$PWD")
SESSION_NAME="${ZONE_NAME//./_}"

tmux new-session -c "$PWD" -s "$SESSION_NAME" -d
tmux new-window -t "$SESSION_NAME:1" -n install -c "$PWD" -d "mise install && mise run install"
"""
